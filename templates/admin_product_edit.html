{% extends "base.html" %}
{% block title %}Edit Product Â· Flash Studio{% endblock %}

{% block content %}
<h1 class="h4 mb-3">Edit Product</h1>

<form class="card card-body shadow-sm" method="post" enctype="multipart/form-data">
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Title</label>
      <input class="form-control" name="title" value="{{ product.title }}" required>
    </div>

    <div class="col-md-3">
      <label class="form-label">Price (S$)</label>
      <input class="form-control" type="number" step="0.01" min="0"
             name="price" value="{{ '%.2f' % (product.price_cents / 100.0) }}" required>
    </div>

    <div class="col-md-3">
      <label class="form-label">Stock</label>
      <input class="form-control" type="number" min="0" name="stock" value="{{ product.stock }}" required>
    </div>

    <div class="col-md-6">
      <label class="form-label">Category</label>
      <select class="form-select" name="category">
        <option value="">Select a category (optional)</option>
        {% for category in categories %}
        <option value="{{ category }}" {{ 'selected' if product.category == category else '' }}>
          {{ category }}
        </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-12">
      <label class="form-label">Description</label>
      <textarea class="form-control" name="description" rows="4">{{ product.description }}</textarea>
    </div>

    <!-- Product Customization Options -->
    <div class="col-12">
      <hr class="my-4">
      <h5 class="mb-3">Product Customization Options</h5>
    </div>

    <div class="col-md-6">
      <label class="form-label">Available Print Sizes</label>
      <div class="border p-3 rounded bg-light">
        {% for size, price_add in size_options.items() %}
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="available_sizes" 
                 value="{{ size }}" id="size_{{ loop.index }}" 
                 {{ 'checked' if size in product.size_options_list else '' }}>
          <label class="form-check-label" for="size_{{ loop.index }}">
            {{ size }}{% if price_add %} (+S$ {{ '%.2f' % (price_add/100.0) }}){% endif %}
          </label>
        </div>
        {% endfor %}
      </div>
      <small class="form-text text-muted">Select which print sizes are available for this product</small>
    </div>

    <div class="col-md-6">
      <label class="form-label">Available Frame Options</label>
      <div class="border p-3 rounded bg-light">
        {% for frame, price_add in frame_options.items() %}
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="available_frames" 
                 value="{{ frame }}" id="frame_{{ loop.index }}" 
                 {{ 'checked' if frame in product.frame_options_list else '' }}>
          <label class="form-check-label" for="frame_{{ loop.index }}">
            {{ frame }}{% if price_add %} (+S$ {{ '%.2f' % (price_add/100.0) }}){% endif %}
          </label>
        </div>
        {% endfor %}
      </div>
      <small class="form-text text-muted">Select which frame options are available for this product</small>
    </div>

    <div class="col-md-6">
      <label class="form-label">Replace media (optional)</label>
      {% if product.media_key %}
      <div class="mb-2">
        <small class="text-muted">Current: 
          <a href="{{ url_for('media', filename=product.media_key) }}" target="_blank" class="text-decoration-none">
            {{ product.media_key[:30] }}{% if product.media_key|length > 30 %}...{% endif %}
          </a>
        </small>
      </div>
      {% endif %}
      <input class="form-control" type="file" name="media" accept="image/*,video/*,application/pdf">
      <div class="form-text">Leave blank to keep current file.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Replace thumbnail (optional)</label>
      {% if product.thumbnail_key %}
      <div class="mb-2">
        <small class="text-muted">Current: 
          <a href="{{ url_for('media', filename=product.thumbnail_key) }}" target="_blank" class="text-decoration-none">
            {{ product.thumbnail_key[:30] }}{% if product.thumbnail_key|length > 30 %}...{% endif %}
          </a>
        </small>
      </div>
      {% endif %}
      <input class="form-control" type="file" name="thumbnail" accept="image/*">
      <div class="form-text">Leave blank to keep current thumbnail.</div>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary">Save changes</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin.dashboard') }}">Cancel</a>
  </div>
</form>
{% endblock %}
