{% extends "base.html" %}
{% block title %}Flash Studio - Professional Film & Photo Production{% endblock %}

{% block content %}
<!-- Hero Section with Video Background -->
<section class="hero-landing position-relative vh-100 d-flex align-items-center">
    <video class="hero-bg img-cover" autoplay muted loop playsinline>
        <source src="{{ url_for('static', filename='video/hero.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <div class="hero-overlay"></div>
    <div class="container position-relative" style="z-index: 2;">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h1 class="display-2 fw-bold text-white mb-4">Crafting Visual Stories</h1>
                <p class="lead text-white-50 mb-4">Award-winning film & photo production studio specializing in commercials, documentaries, and corporate content.</p>
                <a href="#showreel" class="btn btn-primary btn-lg px-4">View Our Work</a>
            </div>
        </div>
    </div>
</section>

<!-- Featured Work / Showreel Section -->
<section id="showreel" class="py-5">
    <div class="container">
        <h2 class="display-4 text-center mb-5">Featured Work</h2>
        
        <div class="row g-4">
            {% for p in featured_products %}
                <div class="col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        {% if p.video_key %}
                            <div class="video-card position-relative">
                                <!-- Video Thumbnail with Play Button -->
                                <div class="video-thumbnail-container" onclick="showVideoPlayer(this)" style="cursor: pointer;">
                                    <img src="{{ url_for('static', filename='uploads/' ~ p.video_thumbnail) if p.video_thumbnail else url_for('static', filename='images/placeholder.jpg') }}" 
                                         class="card-img-top" alt="{{ p.title }}" style="height: 250px; object-fit: cover;">
                                    <div class="play-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                        <div class="play-button text-white">
                                            <i class="bi bi-play-circle-fill display-4"></i>
                                        </div>
                                    </div>
                                    <span class="duration-badge position-absolute bottom-0 end-0 m-2 px-2 py-1 bg-dark text-white rounded">
                                        {{ p.duration_display }}
                                    </span>
                                </div>
                                
                                <!-- Video Player (hidden by default) -->
                                <div class="video-player-container d-none">
                                    <video class="card-img-top" controls autoplay style="height: 250px; object-fit: cover;"
                                           poster="{{ url_for('static', filename='uploads/' ~ p.video_thumbnail) if p.video_thumbnail else url_for('static', filename='images/placeholder.jpg') }}">
                                        <source src="{{ url_for('static', filename='uploads/' ~ p.video_key) }}" type="{{ p.mime_type or 'video/mp4' }}">
                                        Your browser does not support the video tag.
                                    </video>
                                    <div class="video-controls mt-2">
                                        <button class="btn btn-sm btn-secondary me-2" onclick="hideVideoPlayer(this)">
                                            <i class="bi bi-arrow-left"></i> Back to Thumbnail
                                        </button>
                                        <a href="{{ url_for('public.video', product_id=p.id) }}" class="btn btn-sm btn-primary">
                                            <i class="bi bi-fullscreen"></i> Full Screen
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ p.title }}</h5>
                            <p class="card-text text-muted">{{ p.description }}</p>
                            {% if p.client_name %}
                                <small class="text-muted">Client: {{ p.client_name }}</small>
                            {% endif %}
                        </div>
                        {% if p.client_testimonial %}
                            <div class="card-footer bg-white border-0">
                                <blockquote class="blockquote-footer mb-0">
                                    {{ p.client_testimonial }}
                                </blockquote>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Services Overview -->
<section class="bg-light py-5">
    <div class="container">
        <h2 class="text-center mb-5">Our Services</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="text-center">
                    <i class="bi bi-camera-reels display-4 mb-3"></i>
                    <h3>Commercial Production</h3>
                    <p>High-impact video content for brands and businesses</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="bi bi-film display-4 mb-3"></i>
                    <h3>Documentary</h3>
                    <p>Compelling storytelling that captures real moments</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="bi bi-camera display-4 mb-3"></i>
                    <h3>Photography</h3>
                    <p>Professional photography for events and portraits</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action -->
<section class="py-5">
    <div class="container text-center">
        <h2 class="mb-4">Ready to Start Your Project?</h2>
        <p class="lead mb-4">Let's create something amazing together</p>
        <a href="{{ url_for('public.contact') }}" class="btn btn-lg btn-primary">Get in Touch</a>
    </div>
</section>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
.hero-landing {
    height: 100vh;
    overflow: hidden;
}
.hero-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
.video-thumbnail {
    aspect-ratio: 16/9;
    overflow: hidden;
}
.video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.play-overlay {
    background: rgba(0,0,0,0.3);
    opacity: 0;
    transition: all 0.3s ease;
}
.video-thumbnail-container {
    transition: transform 0.3s ease;
}
.video-thumbnail-container:hover {
    transform: scale(1.02);
}
.video-thumbnail-container:hover .play-overlay {
    opacity: 1;
    background: rgba(0,0,0,0.5);
}
.bi-play-circle-fill {
    font-size: 3rem;
    filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
    transition: transform 0.3s ease;
}
.video-thumbnail-container:hover .bi-play-circle-fill {
    transform: scale(1.2);
}
.duration-badge {
    font-size: 0.8rem;
    border-radius: 3px;
    background: rgba(0,0,0,0.7) !important;
    z-index: 2;
}
.video-player.d-none {
    display: none !important;
}
</style>
{% endblock %}

{% block scripts %}
<script>
function showVideoPlayer(thumbnailContainer) {
    try {
        const videoCard = thumbnailContainer.closest('.video-card');
        const thumbnail = videoCard.querySelector('.video-thumbnail-container');
        const videoPlayerContainer = videoCard.querySelector('.video-player-container');
        const video = videoPlayerContainer.querySelector('video');
        
        // Hide thumbnail, show video player
        thumbnail.classList.add('d-none');
        videoPlayerContainer.classList.remove('d-none');
        
        // Try to play the video
        if (video) {
            video.play().catch(error => {
                // Silent fail for autoplay restrictions
            });
        }
    } catch (error) {
        console.error('Error in showVideoPlayer:', error);
    }
}

function hideVideoPlayer(backButton) {
    try {
        const videoCard = backButton.closest('.video-card');
        const thumbnail = videoCard.querySelector('.video-thumbnail-container');
        const videoPlayerContainer = videoCard.querySelector('.video-player-container');
        const video = videoPlayerContainer.querySelector('video');
        
        // Pause video and reset
        if (video) {
            video.pause();
            video.currentTime = 0;
        }
        
        // Show thumbnail, hide video player
        thumbnail.classList.remove('d-none');
        videoPlayerContainer.classList.add('d-none');
    } catch (error) {
        console.error('Error in hideVideoPlayer:', error);
    }
}

// Initialize video handlers
document.addEventListener('DOMContentLoaded', function() {
    const thumbnailContainers = document.querySelectorAll('.video-thumbnail-container');
    
    // Add fallback event listeners
    thumbnailContainers.forEach((container) => {
        container.addEventListener('click', function(e) {
            showVideoPlayer(this);
        });
    });
});
</script>
{% endblock %}
